{
    "kind": "template",
    "type": "Microsoft.Blueprint/blueprints/artifacts",
    "name": "avdDeploy",
    "properties": {
      "displayName": "AVD Template",
      "description": "",
      "dependsOn": [
          "adds",  
          "addsDAUser",
          "dnsSharedSvcs"      
        ],
      "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "parameters": {
              "resourcePrefix": {
                  "type": "string",
                  "metadata": {
                      "displayName": "Resource Prefix"
                  }
              },
              "key-vault-name": {
                "type": "string"
              },
              "baseTime":{
                  "type":"string",
                  "defaultValue": "[utcNow('u')]"
              },
              "nestedTemplatesLocation": {
                  "type": "string",
                  "metadata": {
                      "description": "The base URI where artifacts required by this template are located (controlled by Azure PG)."
                  },
                  "defaultValue": "https://catalogartifact.azureedge.net/publicartifacts/Microsoft.Hostpool-ARM-1.0.14-preview/"
              },
              "artifactsLocation": {
                  "type": "string",
                  "metadata": {
                      "description": "The base URI where artifacts required by this template are located (controlled by AVD PG)."
                  },
                  "defaultValue": "https://wvdportalstorageblob.blob.core.windows.net/galleryartifacts/Configuration.zip"
              },
              "hostpoolName": {
                  "type": "string",
                  "metadata": {
                      "description": "The name of the Hostpool to be created."
                  },
                  "defaultValue": "[variables('hostpoolName')]"
              },
              "hostpoolFriendlyName": {
                  "type": "string",
                  "metadata": {
                      "description": "The friendly name of the Hostpool to be created."
                  },
                  "defaultValue": ""
              },
              "hostpoolDescription": {
                  "type": "string",
                  "metadata": {
                      "description": "The description of the Hostpool to be created."
                  },
                  "defaultValue": ""
              },
              "location": {
                  "type": "string",
                  "metadata": {
                      "description": "The location where the resources will be deployed."
                  }
              },
              "workSpaceName": {
                  "type": "string",
                  "metadata": {
                      "description": "The name of the workspace to be attach to new Application Group."
                  },
                  "defaultValue": ""
              },
              "workspaceLocation": {
                  "type": "string",
                  "metadata": {
                      "description": "The location of the workspace."
                  },
                  "defaultValue": ""
              },
              "workspaceResourceGroup": {
                  "type": "string",
                  "metadata": {
                      "description": "The workspace resource group Name."
                  },
                  "defaultValue": ""
              },
              "allApplicationGroupReferences": {
                  "type": "string",
                  "metadata": {
                      "description": "The existing app groups references of the workspace selected."
                  },
                  "defaultValue": ""
              },
              "addToWorkspace": {
                  "type": "bool",
                  "metadata": {
                      "description": "Whether to add applicationGroup to workspace."
                  }
              },
              "administratorAccountUsername": {
                  "type": "string",
                  "metadata": {
                      "description": "A username in the domain that has privileges to join the session hosts to the domain. For example, 'user1@contoso.com'."
                  },
                  "defaultValue": ""
              },
              "avdHostPool_CreateAvailabilitySet": {
                  "type": "bool",
                  "metadata": {
                      "description": "Whether to create a new availability set for the VMs"
                  },
                  "defaultValue": true
              },
              "availabilityOption": {
                  "type": "string",
                  "metadata": {
                      "description": "Select the availability options for the VMs."
                  },
                  "defaultValue": "AvailabilitySet",
                  "allowedValues": [
                      "None", "AvailabilitySet", "AvailabilityZone"
                  ]
              },
              "availabilitySetName": {
                "type": "string",
                "metadata": {
                    "description": "The name of availability set to be used when creating the session host VMs."
                }
               },
               "availabilitySetUpdateDomainCount": {
                "type": "int",
                "metadata": {
                    "description": "The platform update domain count of the availability set to be created."
                },
                "defaultValue": 5,
                "allowedValues": [
                    1,
                    2,
                    3,
                    4,
                    5,
                    6,
                    7,
                    8,
                    9,
                    10,
                    11,
                    12,
                    13,
                    14,
                    15,
                    16,
                    17,
                    18,
                    19,
                    20
                ]
            },
            "availabilitySetFaultDomainCount": {
                "type": "int",
                "metadata": {
                    "description": "The platform fault domain count of avaiability set to be created."
                },
                "defaultValue": 2,
                "allowedValues": [
                    1,
                    2,
                    3
                ]
            },
              "vmResourceGroup": {
                  "type": "string",
                  "metadata": {
                      "description": "The resource group of the session host VMs."
                  },
                  "defaultValue": ""
              },
              "vmLocation": {
                  "type": "string",
                  "metadata": {
                      "description": "The location of the session host VMs."
                  },
                  "defaultValue": ""
              },
              "avdHostPool_vmSize": {
                  "type": "string",
                  "metadata": {
                      "description": "The size of the session host VMs."
                  },
                  "defaultValue": ""
              },
              "avdHostPool_vmNumberOfInstances": {
                  "type": "int",
                  "metadata": {
                      "description": "Number of session hosts that will be created and added to the hostpool."
                  },
                  "defaultValue": 2
              },
              "vmNamePrefix": {
                  "type": "string",
                  "metadata": {
                      "description": "This prefix will be used in combination with the VM number to create the VM name. If using 'rdsh' as the prefix, VMs would be named 'rdsh-0', 'rdsh-1', etc. You should use a unique prefix to reduce name collisions in Active Directory."
                  },
                  "defaultValue": ""
              },
              "vmImageType": {
                  "type": "string",
                  "metadata": {
                      "description": "Select the image source for the session host vms. VMs from a Gallery image will be created with Managed Disks."
                  },
                  "defaultValue": "Gallery",
                  "allowedValues": [
                      "CustomVHD",
                      "CustomImage",
                      "Gallery"
                  ]
              },
              "vmGalleryImageOffer": {
                  "type": "string",
                  "metadata": {
                      "description": "(Required when vmImageType = Gallery) Gallery image Offer."
                  },
                  "defaultValue": ""
              },
              "vmGalleryImagePublisher": {
                  "type": "string",
                  "metadata": {
                      "description": "(Required when vmImageType = Gallery) Gallery image Publisher."
                  },
                  "defaultValue": ""
              },
              "vmGalleryImageSKU": {
                "type": "string",
                "metadata": {
                    "description": "(Required when vmImageType = Gallery) Gallery image SKU."
                },
                "defaultValue": ""
              },
              "vmImageVhdUri": {
                  "type": "string",
                  "metadata": {
                      "description": "(Required when vmImageType = CustomVHD) URI of the sysprepped image vhd file to be used to create the session host VMs. For example, https://rdsstorage.blob.core.windows.net/vhds/sessionhostimage.vhd"
                  },
                  "defaultValue": ""
              },
              "vmCustomImageSourceId": {
                  "type": "string",
                  "metadata": {
                      "description": "(Required when vmImageType = CustomImage) Resource ID of the image"
                  },
                  "defaultValue": ""
              },
              "vmDiskType": {
                  "type": "string",
                  "allowedValues": [
                      "UltraSSD_LRS",
                      "Premium_LRS",
                      "StandardSSD_LRS",
                      "Standard_LRS"
                  ],
                  "metadata": {
                      "description": "The VM disk type for the VM: HDD or SSD."
                  },
                  "defaultValue": "StandardSSD_LRS"
              },
              "vmUseManagedDisks": {
                  "type": "bool",
                  "metadata": {
                      "description": "True indicating you would like to use managed disks or false indicating you would like to use unmanaged disks."
                  },
                  "defaultValue": true
              },
              "storageAccountResourceGroupName": {
                  "type": "string",
                  "metadata": {
                      "description": "(Required when vmUseManagedDisks = False) The resource group containing the storage account of the image vhd file."
                  },
                  "defaultValue": ""
              },
              "existingVnetName": {
                  "type": "string",
                  "metadata": {
                      "description": "The name of the virtual network the VMs will be connected to."
                  },
                  "defaultValue": ""
              },
              "existingSubnetName": {
                  "type": "string",
                  "metadata": {
                      "description": "The subnet the VMs will be placed in."
                  },
                  "defaultValue": ""
              },
              "virtualNetworkResourceGroupName": {
                  "type": "string",
                  "metadata": {
                      "description": "The resource group containing the existing virtual network."
                  },
                  "defaultValue": ""
              },
              "usePublicIP": {
                  "type": "bool",
                  "metadata": {
                      "description": "Whether to use a Public IP"
                  },
                  "defaultValue": false
              },
              "publicIpAddressSku": {
                  "type": "string",
                  "metadata": {
                      "description": "The sku name of the Public IP"
                  },
                  "allowedValues": [
                      "Basic",
                      "Standard"
                  ],
                  "defaultValue": "Basic"
              },
              "publicIpAddressType": {
                  "type": "string",
                  "metadata": {
                      "description": "The address type of the Public IP"
                  },
                  "allowedValues": [
                      "Dynamic",
                      "Static"
                  ],
                  "defaultValue": "Dynamic"
              },
              "createNetworkSecurityGroup": {
                  "type": "bool",
                  "metadata": {
                      "description": "Whether to create a new network security group or use an existing one"
                  },
                  "defaultValue": false
              },
              "networkSecurityGroupId": {
                  "type": "string",
                  "metadata": {
                      "description": "The resource id of an existing network security group"
                  },
                  "defaultValue": ""
              },
              "networkSecurityGroupRules": {
                  "type": "array",
                  "metadata": {
                      "description": "The rules to be given to the new network security group"
                  },
                  "defaultValue": []
              },
              "avdHostPool_HostPoolType": {
                  "type": "string"
              },
              "personalDesktopAssignmentType": {
                  "type": "string",
                  "allowedValues": [
                      "Automatic",
                      "Direct",
                      ""
                  ],
                  "metadata": {
                      "description": "Set the type of assignment for a Personal hostpool type"
                  },
                  "defaultValue": ""
              },
              "avdHostPool_maxSessionLimit": {
                  "type": "int",
                  "metadata": {
                      "description": "Maximum number of sessions."
                  },
                  "defaultValue": 9999
              },
              "avdHostPool_loadBalancerType": {
                  "type": "string",
                  "allowedValues": [
                      "BreadthFirst",
                      "DepthFirst",
                      "Persistent"
                  ],
                  "metadata": {
                      "description": "Type of load balancer algorithm."
                  },
                  "defaultValue": "BreadthFirst"
              },
              "customRdpProperty": {
                  "type": "string",
                  "metadata": {
                      "description": "Hostpool rdp properties"
                  },
                  "defaultValue": ""
              },
              "vmTemplate": {
                  "type": "string",
                  "metadata": {
                      "description": "The necessary information for adding more VMs to this Hostpool"
                  },
                  "defaultValue": ""
              },
              "tokenExpirationTime": {
                  "type": "string",
                  "metadata": {
                      "description": "Hostpool token expiration time"
                  },
                  "defaultValue": "[dateTimeAdd(parameters('baseTime'), 'PT8H')]"
              },
              "hostpoolTags": {
                  "type": "object",
                  "metadata": {
                      "description": "The tags to be assigned to the hostpool"
                  },
                  "defaultValue": {}
              },
              "applicationGroupTags": {
                  "type": "object",
                  "metadata": {
                      "description": "The tags to be assigned to the application group"
                  },
                  "defaultValue": {}
              },
              "availabilitySetTags": {
                  "type": "object",
                  "metadata": {
                      "description": "The tags to be assigned to the availability set"
                  },
                  "defaultValue": {}
              },
              "networkInterfaceTags": {
                  "type": "object",
                  "metadata": {
                      "description": "The tags to be assigned to the network interfaces"
                  },
                  "defaultValue": {}
              },
              "networkSecurityGroupTags": {
                  "type": "object",
                  "metadata": {
                      "description": "The tags to be assigned to the network security groups"
                  },
                  "defaultValue": {}
              },
              "publicIPAddressTags": {
                  "type": "object",
                  "metadata": {
                      "description": "The tags to be assigned to the public ip addresses"
                  },
                  "defaultValue": {}
              },
              "virtualMachineTags": {
                  "type": "object",
                  "metadata": {
                      "description": "The tags to be assigned to the virtual machines"
                  },
                  "defaultValue": {}
              },
              "imageTags": {
                  "type": "object",
                  "metadata": {
                      "description": "The tags to be assigned to the images"
                  },
                  "defaultValue": {}
              },
              "apiVersion": {
                  "type": "string",
                  "metadata": {
                      "description": "AVD api version"
                  },
                  "defaultValue": "2019-12-10-preview"
              },
              "deploymentId": {
                  "type": "string",
                  "metadata": {
                      "description": "GUID for the deployment"
                  },
                  "defaultValue": "[newGuid()]"
              },
              "validationEnvironment": {
                  "type": "bool",
                  "metadata": {
                      "description": "Whether to use validation environment."
                  },
                  "defaultValue": false
              },
              "preferredAppGroupType": {
                  "type": "string",
                  "metadata": {
                      "description": "Preferred App Group type to display"
                  },
                  "defaultValue": "Desktop"
              },
              "ouPath": {
                  "type": "string",
                  "metadata": {
                      "description": "OUPath for the domain join"
                  },
                  "defaultValue": ""
              },
              "domain": {
                  "type": "string",
                  "metadata": {
                      "description": "Domain to join"
                  },
                  "defaultValue": ""
              }
          },
          "variables": {
              "deployment-prefix": "[concat(parameters('resourcePrefix'), '-sharedsvcs')]",
              "createVMs": "[greater(parameters('avdHostPool_vmNumberOfInstances'),0)]",
              "rdshManagedDisks": "[if(equals(parameters('vmImageType'), 'CustomVHD'), parameters('vmUseManagedDisks'), bool('true'))]",
              "rdshPrefix": "[parameters('vmNamePrefix')]",
              "avSetSKU": "[if(variables('rdshManagedDisks'), 'Aligned', 'Classic')]",
              "existingDomainUsername": "[first(split(parameters('administratorAccountUsername'), '@'))]",
              "key-vault-resourceID": "[resourceId('Microsoft.KeyVault/vaults', parameters('key-vault-name'))]",
              "vhds": "[concat('vhds','/', variables('rdshPrefix'))]",
              "subnet-id": "[resourceId(parameters('virtualNetworkResourceGroupName'),'Microsoft.Network/virtualNetworks/subnets',parameters('existingVnetName'), parameters('existingSubnetName'))]",
              "resourceGroup": "[resourceGroup().name]",
              "hostpoolName": "[replace(parameters('hostpoolName'),'\"','')]",
              "hostpoolFriendlyName": "[parameters('hostpoolFriendlyName')]",
              "vmTemplateName": "[concat( if(variables('rdshManagedDisks'), 'managedDisks', 'unmanagedDisks'), '-', toLower(replace(parameters('vmImageType'),' ', '')), 'vm')]",
              "vmTemplateUri": "[concat(parameters('nestedTemplatesLocation'), variables('vmTemplateName'),'.json')]",
              "rdshVmNamesOutput": {
                  "copy": [
                      {
                          "name": "rdshVmNamesCopy",
                          "count": "[if(variables('createVMs'), parameters('avdHostPool_vmNumberOfInstances'), 1)]",
                          "input": {
                              "name": "[concat(variables('rdshPrefix'),copyIndex('rdshVmNamesCopy'))]"
                          }
                      }
                  ]
              },
              "appGroupName": "[concat(variables('hostpoolName'),'-DAG')]",
              "appGroupResourceId": "[createArray(resourceId('Microsoft.DesktopVirtualization/applicationgroups/', variables('appGroupName')))]",
              "workspaceResourceGroup": "[if(empty(parameters('workspaceResourceGroup')), variables('resourceGroup'), parameters('workspaceResourceGroup'))]",
              "applicationGroupReferencesArr": "[if(equals('',parameters('allApplicationGroupReferences')), variables('appGroupResourceId'), concat(split(parameters('allApplicationGroupReferences'),','), variables('appGroupResourceId')))]"
          },
          "resources": [
              {
                  "name": "[parameters('hostpoolName')]",
                  "apiVersion": "[parameters('apiVersion')]",
                  "type": "Microsoft.DesktopVirtualization/hostpools",
                  "location": "[parameters('location')]",
                  "tags": "[parameters('hostpoolTags')]",
                  "properties": {
                      "friendlyName": "[parameters('hostpoolFriendlyName')]",
                      "description": "[parameters('hostpoolDescription')]",
                      "hostpoolType": "[parameters('avdHostPool_HostPoolType')]",
                      "customRdpProperty": "[parameters('customRdpProperty')]",
                      "personalDesktopAssignmentType": "[parameters('personalDesktopAssignmentType')]",
                      "maxSessionLimit": "[parameters('avdHostPool_maxSessionLimit')]",
                      "loadBalancerType": "[parameters('avdHostPool_loadBalancerType')]",
                      "validationEnvironment": "[parameters('validationEnvironment')]",
                      "preferredAppGroupType": "[parameters('preferredAppGroupType')]",
                      "ring": null,
                      "registrationInfo": {
                          "expirationTime": "[parameters('tokenExpirationTime')]",
                          "token": null,
                          "registrationTokenOperation": "Update"
                      },
                      "vmTemplate": "[parameters('vmTemplate')]"
                  }
              },
              {
                  "name": "[variables('appGroupName')]",
                  "apiVersion": "[parameters('apiVersion')]",
                  "type": "Microsoft.DesktopVirtualization/applicationgroups",
                  "location": "[parameters('location')]",
                  "tags": "[parameters('applicationGroupTags')]",
                  "properties": {
                      "hostpoolarmpath": "[resourceId('Microsoft.DesktopVirtualization/hostpools/', parameters('hostpoolName'))]",
                      "friendlyName": "Default Desktop",
                      "description": "Desktop Application Group created through the Hostpool Wizard",
                      "applicationGroupType": "Desktop"
                  },
                  "dependsOn": [
                      "[resourceId('Microsoft.DesktopVirtualization/hostpools/', parameters('hostpoolName'))]"
                  ]
              },
              {
                  "apiVersion": "2018-05-01",
                  "name": "[concat('Workspace-linkedTemplate-', parameters('deploymentId'))]",
                  "type": "Microsoft.Resources/deployments",
                  "resourceGroup": "[variables('workspaceResourceGroup')]",
                  "condition": "[parameters('addToWorkspace')]",
                  "properties": {
                      "mode": "Incremental",
                      "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "resources": [
                              {
                                  "apiVersion": "[parameters('apiVersion')]",
                                  "name": "[parameters('workSpaceName')]",
                                  "type": "Microsoft.DesktopVirtualization/workspaces",
                                  "location": "[parameters('workspaceLocation')]",
                                  "properties": {
                                      "applicationGroupReferences": "[variables('applicationGroupReferencesArr')]"
                                  }
                              }
                          ]
                      }
                  },
                  "dependsOn": [
                      "[resourceId('Microsoft.DesktopVirtualization/applicationgroups/', variables('appGroupName'))]"
                  ]
              },
              {
                  "apiVersion": "2018-05-01",
                  "name": "[concat('AVSet-linkedTemplate-', parameters('deploymentId'))]",
                  "type": "Microsoft.Resources/deployments",
                  "resourceGroup": "[parameters('vmResourceGroup')]",
                  "condition": "[parameters('avdHostPool_CreateAvailabilitySet')]",
                  "properties": {
                      "mode": "Incremental",
                      "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "resources": [
                              {
                                  "apiVersion": "2018-10-01",
                                  "type": "Microsoft.Compute/availabilitySets",
                                  "name": "[concat(variables('rdshPrefix'), 'availabilitySet-', parameters('vmLocation'))]",
                                  "location": "[parameters('vmLocation')]",
                                  "tags": "[parameters('availabilitySetTags')]",
                                  "properties": {
                                      "platformUpdateDomainCount": 5,
                                      "platformFaultDomainCount": 2
                                  },
                                  "sku": {
                                      "name": "[variables('avSetSKU')]"
                                  }
                              }
                          ]
                      }
                  },
                  "dependsOn": [
                      "[resourceId('Microsoft.DesktopVirtualization/applicationgroups', variables('appGroupName'))]"
                  ]
              },
              {
                  "apiVersion": "2018-05-01",
                  "name": "[concat('vmCreation-linkedTemplate-', parameters('deploymentId'))]",
                  "type": "Microsoft.Resources/deployments",
                  "condition": "[variables('createVMs')]",
                  "resourceGroup": "[parameters('vmResourceGroup')]",
                  "dependsOn": [
                      "[concat('AVSet-linkedTemplate-', parameters('deploymentId'))]"
                  ],
                  "properties": {
                      "mode": "Incremental",
                      "templateLink": {
                          "uri": "[variables('vmTemplateUri')]",
                          "contentVersion": "1.0.0.0"
                      },
                      "parameters": {
                          "artifactsLocation": {
                              "value": "[parameters('artifactsLocation')]"
                          },
                          "vmImageVhdUri": {
                              "value": "[parameters('vmImageVhdUri')]"
                          },
                          "storageAccountResourceGroupName": {
                              "value": "[resourceGroup().name]"
                          },
                          "vmGalleryImageOffer": {
                              "value": "[parameters('vmGalleryImageOffer')]"
                          },
                          "vmGalleryImagePublisher": {
                              "value": "[parameters('vmGalleryImagePublisher')]"
                          },
                          "vmGalleryImageSKU": {
                              "value": "[parameters('vmGalleryImageSKU')]"
                          },
                          "rdshPrefix": {
                              "value": "[variables('rdshPrefix')]"
                          },
                          "rdshNumberOfInstances": {
                              "value": "[parameters('avdHostPool_vmNumberOfInstances')]"
                          },
                          "rdshVMDiskType": {
                              "value": "[parameters('vmDiskType')]"
                          },
                          "rdshVmSize": {
                              "value": "[parameters('avdHostPool_vmSize')]"
                          },
                          "enableAcceleratedNetworking": {
                              "value": false
                          },
                          "administratorAccountUsername": {
                              "value": "[parameters('administratorAccountUsername')]"
                          },
                          "administratorAccountPassword": {
                              "reference": {
                                "keyVault": {
                                  "id": "[resourceId('Microsoft.KeyVault/vaults', parameters('key-vault-name'))]"
                                },
                                "secretName": "[variables('existingDomainUsername')]"
                              }
                          },
                          "subnet-id": {
                              "value": "[variables('subnet-id')]"
                          },
                          "vhds": {
                              "value": "[variables('vhds')]"
                          },
                          "rdshImageSourceId": {
                              "value": "[parameters('vmCustomImageSourceId')]"
                          },
                          "location": {
                              "value": "[parameters('vmLocation')]"
                          },
                          "usePublicIP": {
                              "value": "[parameters('usePublicIP')]"
                          },
                          "publicIpAddressType": {
                              "value": "[parameters('publicIpAddressType')]"
                          },
                          "publicIpAddressSku": {
                              "value": "[parameters('publicIpAddressSku')]"
                          },
                          "createNetworkSecurityGroup": {
                              "value": "[parameters('createNetworkSecurityGroup')]"
                          },
                          "networkSecurityGroupId": {
                              "value": "[parameters('networkSecurityGroupId')]"
                          },
                          "networkSecurityGroupRules": {
                              "value": "[parameters('networkSecurityGroupRules')]"
                          },
                          "networkInterfaceTags": {
                              "value": "[parameters('networkInterfaceTags')]"
                          },
                          "networkSecurityGroupTags": {
                              "value": "[parameters('networkSecurityGroupTags')]"
                          },
                          "publicIPAddressTags": {
                              "value": "[parameters('publicIPAddressTags')]"
                          },
                          "virtualMachineTags": {
                              "value": "[parameters('virtualMachineTags')]"
                          },
                          "imageTags": {
                              "value": "[parameters('imageTags')]"
                          },
                          "hostpoolToken": {
                              "value": "[reference(parameters('hostpoolName')).registrationInfo.token]"
                          },
                          "hostpoolName": {
                              "value": "[parameters('hostpoolName')]"
                          },
                          "domain": {
                              "value": "[parameters('domain')]"
                          },
                          "ouPath": {
                              "value": "[parameters('ouPath')]"
                          }
                      }
                  }
              }
          ],
          "outputs": {
              "rdshVmNamesObject": {
                  "value": "[variables('rdshVmNamesOutput')]",
                  "type": "object"
              }
          }
      },
      "resourceGroup": "ResourceGroup",
      "parameters": {
          "resourcePrefix": {
              "value": "[parameters('resourcePrefix')]"
          },
          "key-vault-name": {
              "value": "[parameters('key-vault-name')]"
          },
          "artifactsLocation": {
              "value": "https://wvdportalstorageblob.blob.core.windows.net/galleryartifacts/Configuration_7-20-2020.zip"
          },
          "nestedTemplatesLocation": {
              "value": "https://catalogartifact.azureedge.net/publicartifacts/Microsoft.Hostpool-ARM-1.0.14-preview/"
          },
          "hostpoolName": {
              "value": "[parameters('avdHostPool_hostpoolName')]"
          },
          "hostpoolDescription": {
              "value": "[parameters('avdHostPool_hostpoolDescription')]"
          },
          "location": {
              "value": "[resourceGroup().location]"
          },
          "validationEnvironment": {
              "value": false
          },
          "addToWorkspace": {
              "value": true
          },
          "avdHostPool_HostPoolType": {
              "value": "[parameters('avdHostPool_HostPoolType')]"
          },
          "avdHostPool_loadBalancerType": {
              "value": "[parameters('avdHostPool_loadBalancerType')]"
          },
          "customRdpProperty": {
              "value": ""
          },
          "vmTemplate": {
              "value": "[concat('{\"domain\":\"', parameters('adds_domainName'), '\",\"galleryImageOffer\":\"', parameters('avdHostPool_vmGalleryImageOffer'), '\",\"galleryImagePublisher\":\"', parameters('avdHostPool_vmGalleryImagePublisher'), '\",\"galleryImageSKU\":\"', parameters('avdHostPool_vmGalleryImageSKU'), '\",\"imageType\":\"', parameters('avdHostPool_vmImageType'), '\",\"imageUri\":null,\"customImageId\":null,\"namePrefix\":\"', parameters('avdHostPool_vmNamePrefix'), '\",\"osDiskType\":\"', parameters('avdHostPool_vmDiskType'), '\",\"useManagedDisks\":', parameters('avdHostPool_vmUseManagedDisks'), ',\"avdHostPool_vmSize\":{\"id\":\"Standard_D2s_v3\",\"cores\":2,\"ram\":8},\"galleryItemId\":\"', parameters('avdHostPool_vmGalleryImagePublisher'), '.',parameters('avdHostPool_vmGalleryImageSKU'),'\"}')]"
          },
          "administratorAccountUsername": {
              "value": "[parameters('daUser_AdminUser')]"
          },
          "avdHostPool_CreateAvailabilitySet": {
              "value": "[parameters('avdHostPool_CreateAvailabilitySet')]"
          },
          "availabilitySetName": {
            "value": "[parameters('availabilitySetName')]"
          },
          "availabilitySetUpdateDomainCount": {
            "value": "[parameters('availabilitySetUpdateDomainCount')]"
          },
          "availabilitySetFaultDomainCount": {
            "value": "[parameters('availabilitySetFaultDomainCount')]"
          },
          "vmResourceGroup": {
              "value": "[resourceGroup().name]"
          },
          "vmLocation": {
              "value": "[resourceGroup().location]"
          },
          "avdHostPool_vmSize": {
              "value": "[parameters('avdHostPool_vmSize')]"
          },
          "avdHostPool_vmNumberOfInstances": {
              "value": "[parameters('avdHostPool_vmNumberOfInstances')]"
          },
          "vmNamePrefix": {
              "value": "[parameters('avdHostPool_vmNamePrefix')]"
          },
          "vmImageType": {
              "value": "Gallery"
          },
          "vmDiskType": {
              "value": "[parameters('avdHostPool_vmDiskType')]"
          },
          "vmUseManagedDisks": {
              "value": "[parameters('avdHostPool_vmUseManagedDisks')]"
          },
          "existingVnetName": {
              "value": "[parameters('adds_vnetName')]"
          },
          "existingSubnetName": {
              "value": "sharedsvcs"
          },
          "virtualNetworkResourceGroupName": {
              "value": "[resourceGroup().name]"
          },
          "usePublicIP": {
              "value": false
          },
          "createNetworkSecurityGroup": {
              "value": false
          },
          "domain": {
              "value": "[parameters('adds_domainName')]"     
          },
          "ouPath": {
              "value": ""
          },
          "hostpoolTags": {
              "value": {}
          },
          "applicationGroupTags": {
              "value": {}
          },
          "availabilitySetTags": {
              "value": {}
          },
          "availabilityOption": {
            "value": "[parameters('availabilityOption')]"
          },
          "networkInterfaceTags": {
              "value": {}
          },
          "networkSecurityGroupTags": {
              "value": {}
          },
          "publicIPAddressTags": {
              "value": {}
          },
          "virtualMachineTags": {
              "value": {}
          },
          "imageTags": {
              "value": {}
          },
          "apiVersion": {
              "value": "2019-12-10-preview"
          },
          "deploymentId": {
              "value": ""
          },
          "vmGalleryImageOffer": {
              "value": "[parameters('avdHostPool_vmGalleryImageOffer')]"
          },
          "vmGalleryImagePublisher": {
              "value": "[parameters('avdHostPool_vmGalleryImagePublisher')]"
          },
          "vmGalleryImageSKU": {
              "value": "[parameters('avdHostPool_vmGalleryImageSKU')]"
          },
          "avdHostPool_maxSessionLimit": {
              "value": "[parameters('avdHostPool_maxSessionLimit')]"
          },
          "workspaceResourceGroup": {
              "value": "[resourceGroup().name]"
          },
          "workspaceName": {
              "value": "[parameters('avdHostPool_workspaceName')]"
          },
          "workspaceLocation": {
              "value": "[resourceGroup().location]"
          },
          "allApplicationGroupReferences": {
              "value": "[parameters('avdHostPool_allApplicationGroupReferences')]"
          }
      }
    }
  }
  
